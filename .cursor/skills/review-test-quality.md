# Skill: review-test-quality

## 触发方式
- "检查测试质量"
- "review 测试"
- "这个测试写得好吗"
- "帮我优化测试代码"
- "测试 code review"

## 描述
对测试文件进行全面质量审查，识别常见问题并提供改进建议和重构后的代码。

---

## Prompt 模板

请对以下测试文件进行质量审查：

```
{粘贴测试文件代码}
```

### 审查维度

按以下维度逐项检查，每项给出：✅ 通过 / ⚠️ 需改进 / ❌ 存在问题

**1. 结构规范**
- [ ] 是否遵循 AAA (Arrange-Act-Assert) 结构
- [ ] 测试命名是否清晰表达意图（`test_<what>_<condition>_<expected>`）
- [ ] 相关测试是否用 class 合理分组

**2. 代码质量**
- [ ] 是否存在重复代码（可提取为 fixture 或 parametrize）
- [ ] 是否有魔法数字/字符串（应提取为常量或 fixture）
- [ ] 断言是否足够精确（避免 `assert result is not None`、`assert result`）

**3. 覆盖完整性**
- [ ] 是否只测试了正常路径（缺少边界/异常测试）
- [ ] 异常测试是否验证了异常类型 AND 错误信息
- [ ] 是否有未测试的代码分支

**4. Mock 使用**
- [ ] 是否过度 mock（mock 了不该 mock 的内部逻辑）
- [ ] mock 是否在正确的路径上（patch 路径是否正确）
- [ ] 是否验证了 mock 的调用（call_count、call_args 等）

**5. 测试独立性**
- [ ] 测试是否依赖执行顺序
- [ ] 是否有全局状态污染风险
- [ ] fixture 的 scope 是否合理

**6. pytest 最佳实践**
- [ ] 是否使用了 `pytest.approx` 进行浮点比较
- [ ] 是否使用 `pytest.raises` 而非 try/except
- [ ] 是否利用了 `@pytest.mark.parametrize` 减少重复

---

### 输出格式

```
## 审查报告

### 总体评分：X/10

### 问题列表
| 严重程度 | 位置 | 问题描述 | 改进建议 |
|---------|------|---------|---------|
| ❌ 严重 | test_xxx L12 | ... | ... |
| ⚠️ 建议 | test_yyy L34 | ... | ... |

### 重构示例
（针对最重要的1-2个问题，给出改进前/后对比代码）
```
